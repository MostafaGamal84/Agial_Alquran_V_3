# طلب إنشاء واجهة برمجية لإحصاءات لوحة التحكم

مرحبًا فريق الباك-إند،

نحتاج إلى تهيئة نقطة نهاية جديدة تعيد إحصاءات لوحة التحكم بناءً على هوية المستخدم المتصل. الواجهة الحالية تعرض أربع بطاقات ملخصة (All Earnings، New Students، Circle Reports، Net Income)، ولكن البيانات المعروضة ما تزال قيمًا افتراضية، لذا نريد تغذيتها بالقيم الفعلية القادمة من الـ API.

كما أن الصفحة تتضمن رسومًا بيانية للإيراد الشهري، ونظرة عامة على المشاريع، وقائمة معاملات، ما يعني أن الواجهة جاهزة لاستقبال بيانات تفصيلية إضافية عند توافرها من الخادم.

المطلوب من نقطة النهاية الجديدة:
1. **آلية الوصول**: تعتمد على المستخدم المصادق عليه (من الـ JWT الحالي)، ولا تعتمد على معلمات إضافية في الاستعلام لتحديد الدور. نحتاج فقط لنداء واحد يعيد الهيكل المناسب حسب الدور المستخرج من الهوية.

2. **تنسيق الاستجابة المقترح (JSON)**:
   ```json
   {
     "role": "Admin|BranchManager|Supervisor|Teacher",
     "metrics": {
       "branchManagersCount": 0,
       "supervisorsCount": 0,
       "teachersCount": 0,
       "studentsCount": 0,
       "circlesCount": 0,
       "reportsCount": 0,
       "...": "إحصاءات إضافية مطلوبة"
     },
     "charts": {
       "monthlyRevenue": [...],
       "projectOverview": {...},
       "transactions": [...]
     }
   }
   ```
   - الحقول الموجودة داخل `metrics` و`charts` يمكن إخفاؤها أو تركها بقيمة `null` إن لم تكن مطلوبة للدور الحالي.
   - الرجاء استخدام نفس أسماء المفاتيح الموجودة في الواجهة قدر الإمكان، مثل `earnings`, `newStudents`, `circleReports`, `netIncome` للبطاقات الأربع الحالية، لتسهيل الربط مع المكوّنات الموجودة.

3. **تفاصيل الإحصاءات حسب الدور**:
   - **المدير العام (Admin)**:
     - إجمالي عدد مديري الفروع، المشرفين، المعلمين، الطلاب، الحلقات، والتقارير المرفوعة (على مستوى النظام).
     - مقترحات إضافية مستوحاة من تصميم اللوحة الحالية:
       - إجمالي الإيرادات وصافي الدخل لتغذية بطاقتي `All Earnings` و`Net Income`.
       - عدد الطلاب الجدد خلال فترة محددة لتغذية بطاقة `New Students`.
       - عدد تقارير الحلقات المرسلة أو المعالجة لتغذية بطاقة `Circle Reports`.
       - بيانات الإيراد الشهري لإظهارها في مخطط `Monthly Revenue`.
       - مؤشرات نظرة عامة على المشاريع/الحلقات النشطة يمكن تمثيلها في قسم `Project Overview`.
       - ملخص لأحدث العمليات المالية أو التسجيلات لتغذية قائمة `Transaction`.
   - **مدير الفرع (Branch Manager)**:
     - نفس الإحصاءات المذكورة أعلاه لكن مقصورة على الفرع المرتبط به: عدد المشرفين، المعلمين، الطلاب، الحلقات، والتقارير المرفوعة الخاصة بالفرع.
     - يمكن أيضًا توفير ملخص صغير لإيرادات أو أداء الفرع فقط لتغذية البطاقات والمخططات الخاصة به عند الحاجة.

   - **المشرف (Supervisor)**:
     - عدد المعلمين، الطلاب، الحلقات، والتقارير المرفوعة الخاضعة لإشرافه المباشر.

   - **المعلم (Teacher)**:
     - عدد الطلاب والحلقات والتقارير المرفوعة الخاصة به فقط (مثلاً تقارير التقييم اليومية أو الأسبوعية الخاصة بحلقاته).

4. **اعتبارات إضافية**:
   - يُفضل دعم فترات زمنية قابلة للتخصيص مستقبلًا (مثلاً `?range=monthly`)، لكن يمكن البدء بالقيم الافتراضية (آخر 30 يومًا) إلى أن نضيف خيارات الواجهة.
   - إذا كان حساب الدور يحتاج إلى أكثر من جدول (مثلاً الانتماء إلى فرع)، الرجاء التأكد من إدراج جميع عمليات الربط اللازمة في الاستعلامات (join) للحصول على عدد دقيق دون تكرار.
   - ينبغي توثيق مفاتيح الاستجابة وقيمها المحتملة في Swagger/OpenAPI حتى يكون الفريق الأمامي قادرًا على دمجها مباشرة.

إن احتجتم لأي توضيحات إضافية حول كيفية استهلاك البيانات من جهة الواجهة، فأنا متاح دائمًا. شكرًا مقدمًا على التعاون.
