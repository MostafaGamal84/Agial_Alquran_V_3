<div class="row p-t-25">
  <div class="col-12">
    <app-card cardTitle="Course Details" padding="0" cardClass="sm-block course-details-card">
      <div class="course-details">
        <ng-container *ngIf="course as currentCourse; else placeholderCourse">
          <div class="course-header">
            <div class="course-title">
              <h3 class="course-name">{{ currentCourse?.name || 'Untitled Course' }}</h3>
              <div
                class="course-teacher"
                *ngIf="currentCourse?.teacher || currentCourse?.teacherName || currentCourse?.teacherId"
              >
                <i class="ti ti-user"></i>
                <span>{{ currentCourse?.teacher?.fullName || currentCourse?.teacherName || currentCourse?.teacherId }}</span>
              </div>
            </div>
            <div class="course-summary">
              <div class="summary-item">
                <span class="summary-count">{{ dataSource.data.length }}</span>
                <span class="summary-label">Students</span>
              </div>
              <ng-container *ngIf="getManagers(currentCourse) as managers">
                <div class="summary-item" *ngIf="managers.length">
                  <span class="summary-count">{{ managers.length }}</span>
                  <span class="summary-label">Managers</span>
                </div>
              </ng-container>
              <ng-container *ngIf="getSchedule(currentCourse) as schedule">
                <div class="summary-item" *ngIf="schedule.length">
                  <span class="summary-count">{{ schedule.length }}</span>
                  <span class="summary-label">Sessions / Week</span>
                </div>
              </ng-container>
              <div class="summary-item" *ngIf="getFormattedStartTime(currentCourse)">
                <span class="summary-count">{{ getFormattedStartTime(currentCourse) }}</span>
                <span class="summary-label">Start Time</span>
              </div>
            </div>
          </div>
          <div class="course-body">
            <ng-container *ngIf="getSchedule(currentCourse) as schedule">
              <section class="info-block" *ngIf="schedule.length; else fallbackScheduleBlock">
                <div class="info-header">
                  <i class="ti ti-calendar-event"></i>
                  <span>Weekly Schedule</span>
                </div>
                <div class="chip-list">
                  <span class="chip" *ngFor="let day of schedule">
                    <span class="chip-title">{{ getScheduleDayLabel(day) }}</span>
                    <ng-container *ngIf="getScheduleTimeLabel(day) as time">
                      <span class="chip-separator">â€¢</span>
                      <span class="chip-meta">{{ time }}</span>
                    </ng-container>
                  </span>
                </div>
              </section>
              <ng-template #fallbackScheduleBlock>
                <section class="info-block" *ngIf="getDayLabel(currentCourse) || getFormattedStartTime(currentCourse)">
                  <div class="info-header">
                    <i class="ti ti-calendar-event"></i>
                    <span>Schedule</span>
                  </div>
                  <div class="info-grid">
                    <div class="info-item" *ngIf="getDayLabel(currentCourse)">
                      <span class="info-label">Day</span>
                      <span class="info-value">{{ getDayLabel(currentCourse) }}</span>
                    </div>
                    <div class="info-item" *ngIf="getFormattedStartTime(currentCourse)">
                      <span class="info-label">Start Time</span>
                      <span class="info-value">{{ getFormattedStartTime(currentCourse) }}</span>
                    </div>
                  </div>
                </section>
              </ng-template>
            </ng-container>
            <ng-container *ngIf="getManagers(currentCourse) as managers">
              <section class="info-block" *ngIf="managers.length">
                <div class="info-header">
                  <i class="ti ti-users"></i>
                  <span>Managers</span>
                </div>
                <div class="chip-list">
                  <span class="chip chip--soft" *ngFor="let manager of managers">
                    <i class="ti ti-user-check"></i>
                    <span class="chip-title">{{ manager }}</span>
                  </span>
                </div>
              </section>
            </ng-container>
          </div>
        </ng-container>
        <ng-template #placeholderCourse>
          <div class="empty-state">
            <i class="ti ti-loader-2"></i>
            <span>Course details will appear once loaded.</span>
          </div>
        </ng-template>
      </div>
      <mat-divider></mat-divider>
      <div class="students-section">
        <div class="section-heading">
          <div>
            <h6 class="section-title">Enrolled Students</h6>
            <p class="section-subtitle">Students participating in this course.</p>
          </div>
          <span class="badge">{{ students.length }}</span>
        </div>
        <div class="students-grid" *ngIf="students.length; else emptyStudents">
          <article class="student-card" *ngFor="let student of students">
            <div class="student-meta">
              <div class="student-avatar" aria-hidden="true">
                <span>{{ getStudentInitials(student) }}</span>
              </div>
              <div class="student-info">
                <h6 class="student-name">{{ getStudentName(student) }}</h6>
                <p class="student-id" *ngIf="getStudentIdentifier(student) as identifier">
                  {{ identifier }}
                </p>
              </div>
            </div>
            <div class="student-actions">
              <a
                matTooltip="Add Report"
                [routerLink]="['/online-course/student/report/add', student.studentId || student.id]"
                [state]="{ circle: course }"
                class="student-action"
              >
                <i class="ti ti-report"></i>
                <span>Add report</span>
              </a>
            </div>
          </article>
        </div>
        <ng-template #emptyStudents>
          <div class="empty-students">No students found</div>
        </ng-template>
      </div>
    </app-card>
  </div>
</div>
