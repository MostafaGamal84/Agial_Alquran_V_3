<div class="dialog-head" mat-dialog-title>
  <div class="head-row">
    <div class="title">بيانات المشرف</div>

    <button mat-icon-button class="close-btn" mat-dialog-close aria-label="إغلاق">
      <i class="ti ti-x"></i>
    </button>
  </div>
</div>

<mat-dialog-content class="dialog-content">

  <div class="loading-state" *ngIf="loading">
    <mat-spinner diameter="48"></mat-spinner>
    <div class="loading-text">جاري تحميل البيانات...</div>
  </div>

  <app-scrollbar *ngIf="!loading && vm as m" [customStyle]="{ maxHeight: 'calc(100vh - 155px)', position: 'relative' }">

    <div class="wrap">

      <!-- ====== Header Card ====== -->
      <section class="card hero">
        <div class="hero-left">
          <div class="avatar">
            <i class="ti ti-user"></i>
          </div>

          <div class="hero-meta">
            <div class="name">{{ m.fullName || '—' }}</div>

            <div class="sub">
              <span class="pill">
                <i class="ti ti-building-store"></i>
                {{ getBranchLabel(m.branchId) }}
              </span>

              <span class="pill" *ngIf="m.inactive !== undefined" [class.is-inactive]="!!m.inactive">
                <i class="ti" [class.ti-circle-check]="!m.inactive" [class.ti-circle-x]="!!m.inactive"></i>
                {{ m.inactive ? 'غير نشط' : 'نشط' }}
              </span>
            </div>
          </div>
        </div>

        <div class="hero-right" *ngIf="statEntries.length">
          <div class="mini" *ngFor="let s of statEntries">
            <div class="mini-k">{{ s.label }}</div>
            <div class="mini-v">{{ s.value || '—' }}</div>
          </div>
        </div>
      </section>

      <!-- ====== Contact Card ====== -->
      <section class="card" *ngIf="contactEntries.length">
        <div class="card-title">
          <i class="ti ti-address-book"></i>
          بيانات التواصل
        </div>

        <div class="contact-grid">
          <a class="contact-item"
             *ngFor="let c of contactEntries"
             [href]="c.href || null"
             [class.is-link]="!!c.href"
             (click)="$event.stopPropagation()">

            <div class="c-ico"><i [class]="c.icon"></i></div>
            <div class="c-body">
              <div class="c-label">{{ c.label }}</div>
              <div class="c-value">{{ c.value || '—' }}</div>
            </div>

            <i class="ti ti-external-link hint" *ngIf="c.href"></i>
          </a>
        </div>
      </section>

      <!-- ====== Details Card ====== -->
      <section class="card" *ngIf="detailEntries.length">
        <div class="card-title">
          <i class="ti ti-id"></i>
          البيانات الأساسية
        </div>

        <div class="kv-grid">
          <div class="kv" *ngFor="let e of detailEntries">
            <div class="k">{{ e.label }}</div>
            <div class="v">{{ e.value }}</div>
          </div>
        </div>
      </section>

      <!-- ====== Lists ====== -->
      <section class="card" *ngIf="teachers.length || students.length || managerCircles.length">
        <div class="card-title">
          <i class="ti ti-list-details"></i>
          الارتباطات
        </div>

        <mat-accordion class="acc">

          <!-- Teachers -->
          <mat-expansion-panel *ngIf="teachers.length">
            <mat-expansion-panel-header>
              <mat-panel-title>
                المعلمون
                <span class="count">{{ teachers.length }}</span>
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div class="rows">
              <div class="row" *ngFor="let t of teachers">
                <div class="row-main">
                  <div class="row-title">{{ t.fullName || '—' }}</div>
                  <div class="row-sub">{{ t.mobile || '—' }}</div>
                </div>
                <a class="row-action row-action--website"
                   *ngIf="t.mobile"
                   [href]="academyWebsiteUrl"
                   target="_blank"
                   rel="noopener"
                   (click)="$event.stopPropagation()">
                  <i class="ti ti-world"></i>
                  موقع الأكاديمية
                </a>
              </div>
            </div>
          </mat-expansion-panel>

          <!-- Students -->
          <mat-expansion-panel *ngIf="students.length">
            <mat-expansion-panel-header>
              <mat-panel-title>
                الطلاب
                <span class="count">{{ students.length }}</span>
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div class="rows">
              <div class="row" *ngFor="let s of students">
                <div class="row-main">
                  <div class="row-title">{{ s.fullName || '—' }}</div>
                  <div class="row-sub">{{ s.mobile || '—' }}</div>
                </div>
                <a class="row-action row-action--website"
                   *ngIf="s.mobile"
                   [href]="academyWebsiteUrl"
                   target="_blank"
                   rel="noopener"
                   (click)="$event.stopPropagation()">
                  <i class="ti ti-world"></i>
                  موقع الأكاديمية
                </a>
              </div>
            </div>
          </mat-expansion-panel>

          <!-- Circles -->
          <mat-expansion-panel *ngIf="managerCircles.length">
            <mat-expansion-panel-header>
              <mat-panel-title>
                الحلقات
                <span class="count">{{ managerCircles.length }}</span>
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div class="rows">
              <div class="row" *ngFor="let c of managerCircles">
                <div class="row-main">
                  <div class="row-title">{{ c.circle || '—' }}</div>
                </div>
              </div>
            </div>
          </mat-expansion-panel>

        </mat-accordion>
      </section>

    </div>

  </app-scrollbar>
</mat-dialog-content>
