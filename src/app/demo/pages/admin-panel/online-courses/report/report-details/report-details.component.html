<div class="row p-t-25">
  <div class="col-12">
    <app-card [cardTitle]="'تفاصيل التقرير' | translate" cardClass="sm-block">

      <!-- زر تعديل التقرير -->
      <ng-template #headerOptionsTemplate>
        <div class="header-actions" *ngIf="canEdit && report?.id">
          <button mat-stroked-button color="primary" (click)="editReport()">
            <div class="flex align-item-center">
              <i class="ti ti-edit f-18 m-r-5"></i>
              {{ 'تعديل التقرير' | translate }}
            </div>
          </button>
          <button
            mat-icon-button
            color="warn"
            [disabled]="isDeleting"
            (click)="deleteReport()"
            [matTooltip]="'Delete report' | translate"
          >
            <i class="ti ti-trash f-18"></i>
          </button>
        </div>
      </ng-template>

      <!-- حالة التحميل -->
      <ng-container *ngIf="!isLoading; else loadingTemplate">
        <ng-container *ngIf="report; else emptyState">

          <div class="details-grid">

            <!-- قسم: بيانات عامة -->
            <section class="details-section">
              <h6>{{ 'البيانات العامة' | translate }}</h6>

              <div class="detail-item">
                <span class="label">{{ 'الحلقة' | translate }}</span>
                <span class="value">{{ getCircleName() }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'الطالب' | translate }}</span>
                <span class="value">{{ getStudentName() }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'المعلم' | translate }}</span>
                <span class="value">{{ getTeacherName() }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'حالة الحضور' | translate }}</span>
                <span class="value">{{ getStatusLabel(report?.attendStatueId) }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'المدة (بالدقائق)' | translate }}</span>
                <span class="value">{{ displayValue(report?.minutes) }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'تاريخ الإنشاء' | translate }}</span>
                <span class="value">{{ formatDate(report?.creationTime) }}</span>
              </div>
            </section>

            <!-- قسم: الدرس الجديد -->
            <section class="details-section">
              <h6>{{ 'الدرس الجديد' | translate }}</h6>

              <div class="detail-item">
                <span class="label">{{ 'السورة' | translate }}</span>
                <span class="value">{{ displayValue(report?.newId) }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'من' | translate }}</span>
                <span class="value">{{ displayValue(report?.newFrom) }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'إلى' | translate }}</span>
                <span class="value">{{ displayValue(report?.newTo) }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'التقدير' | translate }}</span>
                <span class="value">{{ displayValue(report?.newRate) }}</span>
              </div>
            </section>

            <!-- قسم: المراجعة -->
            <section class="details-section">
              <h6>{{ 'المراجعة' | translate }}</h6>

              <div class="detail-item">
                <span class="label">{{ 'المراجعة القريبة' | translate }}</span>
                <span class="value">{{ displayValue(report?.recentPast) }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'تقدير المراجعة القريبة' | translate }}</span>
                <span class="value">{{ displayValue(report?.recentPastRate) }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'المراجعة البعيدة' | translate }}</span>
                <span class="value">{{ displayValue(report?.distantPast) }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'تقدير المراجعة البعيدة' | translate }}</span>
                <span class="value">{{ displayValue(report?.distantPastRate) }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'المراجعة الأبعد' | translate }}</span>
                <span class="value">{{ displayValue(report?.farthestPast) }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'تقدير المراجعة الأبعد' | translate }}</span>
                <span class="value">{{ displayValue(report?.farthestPastRate) }}</span>
              </div>
            </section>

            <!-- قسم: ملاحظات إضافية -->
            <section class="details-section">
              <h6>{{ 'ملاحظات إضافية' | translate }}</h6>

              <div class="detail-item">
                <span class="label">{{ 'كلمات غريب القرآن' | translate }}</span>
                <span class="value">{{ displayValue(report?.theWordsQuranStranger) }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'التجويد' | translate }}</span>
                <span class="value">{{ displayValue(report?.intonation) }}</span>
              </div>

              <div class="detail-item">
                <span class="label">{{ 'ملاحظات أخرى' | translate }}</span>
                <span class="value">{{ displayValue(report?.other) }}</span>
              </div>
            </section>

          </div>

        </ng-container>
      </ng-container>

      <!-- لودر -->
      <ng-template #loadingTemplate>
        <div class="loading-container">
          <mat-progress-spinner diameter="48" mode="indeterminate"></mat-progress-spinner>
        </div>
      </ng-template>

      <!-- حالة لا توجد بيانات -->
      <ng-template #emptyState>
        <div class="empty-state">
          <i class="ti ti-notebook f-32 m-b-10"></i>
          <p>{{ 'لا توجد بيانات متاحة لهذا التقرير.' | translate }}</p>
        </div>
      </ng-template>

    </app-card>
  </div>
</div>
