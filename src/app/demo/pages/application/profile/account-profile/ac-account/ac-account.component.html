<div class="row m-t-25">
  <div class="col-12">
    <app-card cardTitle="My Profile">
      <mat-progress-bar *ngIf="isLoadingProfile" mode="indeterminate"></mat-progress-bar>

      @if (profileError && !isLoadingProfile) {
        <div class="mat-caption text-warn-500 m-b-15">{{ profileError }}</div>
      }

      <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="profile-form">
        <div class="row">
          <div class="col-md-6 m-b-15">
            <label class="f-w-500" for="fullName">
              Full Name
              <span class="text-warn-500">*</span>
            </label>
            <mat-form-field appearance="outline" class="w-100 m-t-5">
              <input
                id="fullName"
                type="text"
                matInput
                placeholder="Enter full name"
                formControlName="fullName"
              />
              @if (profileForm.get('fullName')?.touched && profileForm.get('fullName')?.hasError('required')) {
                <mat-error>Full name is required.</mat-error>
              }
              @if (profileForm.get('fullName')?.touched && profileForm.get('fullName')?.hasError('maxlength')) {
                <mat-error>Maximum 150 characters allowed.</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="col-md-6 m-b-15">
            <label class="f-w-500" for="email">
              Email
              <span class="text-warn-500">*</span>
            </label>
            <mat-form-field appearance="outline" class="w-100 m-t-5">
              <input id="email" type="email" matInput placeholder="Enter email" formControlName="email" />
              @if (profileForm.get('email')?.touched && profileForm.get('email')?.hasError('required')) {
                <mat-error>Email is required.</mat-error>
              }
              @if (profileForm.get('email')?.touched && profileForm.get('email')?.hasError('email')) {
                <mat-error>Enter a valid email address.</mat-error>
              }
              @if (profileForm.get('email')?.touched && profileForm.get('email')?.hasError('maxlength')) {
                <mat-error>Maximum 150 characters allowed.</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="col-md-6 m-b-15">
            <label class="f-w-500" for="mobile">
              Mobile Number
              <span class="text-warn-500">*</span>
            </label>
            <mat-form-field appearance="outline" class="w-100 m-t-5">
              <input
                id="mobile"
                type="tel"
                matInput
                placeholder="Enter mobile number"
                formControlName="mobile"
              />
              @if (profileForm.get('mobile')?.touched && profileForm.get('mobile')?.hasError('required')) {
                <mat-error>Mobile number is required.</mat-error>
              }
              @if (profileForm.get('mobile')?.touched && profileForm.get('mobile')?.hasError('maxlength')) {
                <mat-error>Maximum 25 characters allowed.</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="col-md-6 m-b-15">
            <label class="f-w-500" for="secondMobile">Secondary Mobile</label>
            <mat-form-field appearance="outline" class="w-100 m-t-5">
              <input
                id="secondMobile"
                type="tel"
                matInput
                placeholder="Enter secondary mobile"
                formControlName="secondMobile"
              />
              @if (profileForm.get('secondMobile')?.touched && profileForm.get('secondMobile')?.hasError('maxlength')) {
                <mat-error>Maximum 25 characters allowed.</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="col-md-4 m-b-15">
            <label class="f-w-500" for="nationalityId">
              Nationality
              <span class="text-warn-500">*</span>
            </label>
            <mat-form-field appearance="outline" class="w-100 m-t-5">
              <mat-select id="nationalityId" placeholder="Select nationality" formControlName="nationalityId">
                @for (nation of nationalities; track nation.id) {
                  <mat-option [value]="nation.id">{{ nation.name }}</mat-option>
                }
              </mat-select>
              @if (profileForm.get('nationalityId')?.touched && profileForm.get('nationalityId')?.hasError('required')) {
                <mat-error>Nationality is required.</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="col-md-4 m-b-15">
            <label class="f-w-500" for="governorateId">
              Governorate
              @if (isGovernorateRequired) {
                <span class="text-warn-500">*</span>
              }
            </label>
            <mat-form-field appearance="outline" class="w-100 m-t-5">
              <mat-select id="governorateId" placeholder="Select governorate" formControlName="governorateId">
                @for (gov of governorates; track gov.id) {
                  <mat-option [value]="gov.id">{{ gov.name }}</mat-option>
                }
              </mat-select>
              @if (profileForm.get('governorateId')?.touched && profileForm.get('governorateId')?.hasError('required')) {
                <mat-error>{{ 'EgyptGovernorateRequiredMessage' | translate }}</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="col-md-4 m-b-15">
            <label class="f-w-500" for="branchId">
              Branch
              <span class="text-warn-500">*</span>
            </label>
            <mat-form-field appearance="outline" class="w-100 m-t-5">
              <mat-select id="branchId" placeholder="Select branch" formControlName="branchId">
                @for (branch of branches; track branch.id) {
                  <mat-option [value]="branch.id">{{ branch.label }}</mat-option>
                }
              </mat-select>
              @if (profileForm.get('branchId')?.touched && profileForm.get('branchId')?.hasError('required')) {
                <mat-error>Branch is required.</mat-error>
              }
            </mat-form-field>
          </div>
        </div>

        <div class="text-end m-t-25">
          <button
            type="button"
            mat-stroked-button
            class="m-r-10"
            (click)="onReset()"
            [disabled]="isSaving || isLoadingProfile"
          >
            Reset
          </button>
          <button
            type="submit"
            mat-flat-button
            color="primary"
            [disabled]="
              profileForm.invalid || profileForm.pristine || isSaving || isLoadingProfile
            "
          >
            @if (isSaving) {
              Saving...
            } @else {
              Save Changes
            }
          </button>
        </div>
      </form>
    </app-card>
  </div>
</div>
