<div class="auth-main">
  <div class="auth-wrapper version-1">
    <div class="auth-form">
      <div class="auth-background">
        <div class="yellow-circle"></div>
        <div class="red-circle"></div>
      </div>
      <div class="main-form">
        <app-card [showHeader]="false" class="auth-form-card" padding="40">
          <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" class="text-start">
            <div class="forgot-logo m-b-25">
              <a href="javascript:">
                <img src="assets/images/logo-dark.svg" alt="logo" />
              </a>
            </div>
            <div class="check-me m-b-10">
              <h3 class="m-b-0">Reset Password</h3>
              <a
                href="javascript:"
                class="text-primary-500"
                [routerLink]="[this.authenticationService.isLoggedIn() ? '/authentication-1/login' : '/login']"
              >
                Back to Login
              </a>
            </div>
            @if (confirmationMessage) {
              <p class="text-muted forgot-logo m-b-15">{{ confirmationMessage }}</p>
            }
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Verification code</mat-label>
              <input
                matInput
                inputmode="numeric"
                maxlength="4"
                autocomplete="one-time-code"
                formControlName="code"
              />
              @if (codeControl.invalid && (codeControl.dirty || codeControl.touched)) {
                <mat-error>{{ getCodeError() }}</mat-error>
              }
            </mat-form-field>
            <div class="resend-row m-b-15">
              <span class="timer-label text-muted">
                @if (canResend) {
                  يمكنك إعادة إرسال الرمز الآن
                } @else {
                  سينتهي الرمز خلال {{ countdownLabel }}
                }
              </span>
              <button
                mat-stroked-button
                color="primary"
                type="button"
                class="resend-btn"
                (click)="resendCode()"
                [disabled]="!canResend || resendLoading"
              >
                @if (resendLoading) {
                  <mat-progress-spinner class="btn-spinner" diameter="16" mode="indeterminate"></mat-progress-spinner>
                }
                إعادة إرسال الرمز
              </button>
            </div>
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>New password</mat-label>
              <input
                matInput
                [type]="hidePassword ? 'password' : 'text'"
                formControlName="newPassword"
                autocomplete="new-password"
              />
              <button
                mat-icon-button
                type="button"
                matSuffix
                (click)="hidePassword = !hidePassword"
                [attr.aria-label]="'Toggle password visibility'"
                [attr.aria-pressed]="!hidePassword"
              >
                <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              @if (newPasswordControl.invalid && (newPasswordControl.dirty || newPasswordControl.touched)) {
                <mat-error>{{ getPasswordError() }}</mat-error>
              }
            </mat-form-field>
            <div class="grid">
              <button mat-flat-button color="primary" class="b-rad-20 m-t-20" type="submit" [disabled]="loading">
                @if (loading) {
                  <mat-progress-spinner class="btn-spinner" mode="indeterminate" diameter="20"></mat-progress-spinner>
                  <span>Saving...</span>
                } @else {
                  Reset Password
                }
              </button>
            </div>
          </form>
        </app-card>
      </div>
    </div>
  </div>
</div>
