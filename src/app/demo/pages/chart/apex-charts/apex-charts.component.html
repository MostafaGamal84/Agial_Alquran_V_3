<div class="row p-t-25 g-3">
  <div class="col-12">
    <div class="row g-3">
      <div class="col-sm-6 col-xl-3" *ngFor="let metric of totalsList; trackBy: trackByKey">
        <app-card>
          <div class="d-flex flex-column gap-1">
            <span class="text-muted text-uppercase f-12">{{ metric.label }}</span>
            <h5 class="mb-0">{{ metric.value | number }}</h5>
          </div>
        </app-card>
      </div>
      <div class="col-12" *ngIf="!totalsList.length">
        <app-card>
          <p class="mb-0 text-center text-muted">لا توجد بيانات إجمالية للمشتركين.</p>
        </app-card>
      </div>
    </div>
  </div>

  <div class="col-xl-8 col-lg-7">
    <app-card cardTitle="المشتركين حسب النوع">
      <apx-chart
        [series]="barChart.series"
        [chart]="barChart.chart"
        [dataLabels]="barChart.dataLabels"
        [plotOptions]="barChart.plotOptions"
        [xaxis]="barChart.xaxis"
        [grid]="barChart.grid"
        [colors]="preset"
        [tooltip]="barChart.tooltip"
      ></apx-chart>
    </app-card>
  </div>

  <div class="col-xl-4 col-lg-5">
    <div class="row g-3">
      <div class="col-12">
        <app-card cardTitle="توزيع المشتركين (دونات)">
          <apx-chart
            [series]="donutChart.series"
            [chart]="donutChart.chart"
            [dataLabels]="donutChart.dataLabels"
            [legend]="donutChart.legend"
            [labels]="donutChart.labels"
            [colors]="pie_color"
            [tooltip]="donutChart.tooltip"
          ></apx-chart>
        </app-card>
      </div>
      <div class="col-12">
        <app-card cardTitle="توزيع المشتركين (باي)">
          <apx-chart
            [series]="pieChart.series"
            [chart]="pieChart.chart"
            [dataLabels]="pieChart.dataLabels"
            [legend]="pieChart.legend"
            [labels]="pieChart.labels"
            [colors]="pie_color"
            [tooltip]="pieChart.tooltip"
          ></apx-chart>
        </app-card>
      </div>
      <div class="col-12">
        <app-card cardTitle="تفاصيل التوزيع">
          <div class="list-group list-group-flush" *ngIf="distributionSlices.length; else distributionEmpty">
            <div class="list-group-item px-0 border-0" *ngFor="let slice of distributionSlices; trackBy: trackBySlice">
              <div class="d-flex justify-content-between align-items-center gap-3">
                <div>
                  <span class="d-block fw-semibold">{{ slice.label }}</span>
                  <small class="text-muted">{{ (slice.percentage ?? 0) | number: '1.0-2' }}%</small>
                </div>
                <div class="text-end">
                  <span class="fw-semibold">{{ slice.value | number }}</span>
                </div>
              </div>
            </div>
          </div>
          <ng-template #distributionEmpty>
            <p class="mb-0 text-center text-muted">لا توجد بيانات توزيع متاحة.</p>
          </ng-template>
        </app-card>
      </div>
    </div>
  </div>

  <div class="col-12">
    <app-card cardTitle="تفاصيل المشتركين حسب النوع">
      <div class="table-responsive" *ngIf="breakdown.length && breakdownColumns.length; else emptyBreakdown">
        <table class="table table-hover mb-0">
          <thead>
            <tr>
              <th *ngFor="let column of breakdownColumns">{{ toDisplayLabel(column) }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of breakdown; trackBy: trackByBreakdown">
              <td *ngFor="let column of breakdownColumns">{{ getDisplayValue(row, column) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <ng-template #emptyBreakdown>
        <p class="mb-0 text-center text-muted">لا توجد بيانات تفصيلية متاحة.</p>
      </ng-template>
    </app-card>
  </div>
</div>
